<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
	<title>음식점 목록</title>
</head>
<main>
	<!-- 검색 폼 -->
	<div class="row mb-4">
		<div class="col-md-6">
			<form th:action="@{/restaurants}" method="get" class="input-group">
				<input type="text" name="query" th:value="${param.query}" class="form-control" placeholder="음식점 이름 검색">
				<button type="submit" class="btn btn-primary">검색</button>
			</form>
		</div>
	</div>

	<!-- 네이버 검색 결과 -->
	<div th:if="${searchResult != null}" class="mb-5">
		<h2 class="mb-3">검색 결과</h2>
		<div class="row row-cols-1 row-cols-md-2 g-4">
			<div class="col">
				<div class="card h-100">
					<img th:src="${searchResult.imageLink}" class="card-img-top" alt="음식점 이미지" th:unless="${searchResult.imageLink == null}">
					<div class="card-body">
						<h5 class="card-title" th:utext="${searchResult.title}"></h5>
						<p class="card-text" th:text="${searchResult.category}"></p>
						<p class="card-text" th:text="${searchResult.address}"></p>
						<p class="card-text" th:text="${searchResult.roadAddress}"></p>
						<a th:href="${searchResult.homePageLink}" class="card-link" th:unless="${searchResult.homePageLink == null}">홈페이지</a>
						<form th:action="@{/restaurants/bookmark}" method="post" class="d-inline">
							<input type="hidden" name="title" th:value="${searchResult.title}">
							<input type="hidden" name="category" th:value="${searchResult.category}">
							<input type="hidden" name="address" th:value="${searchResult.address}">
							<input type="hidden" name="roadAddress" th:value="${searchResult.roadAddress}">
							<input type="hidden" name="homePageLink" th:value="${searchResult.homePageLink}">
							<input type="hidden" name="imageLink" th:value="${searchResult.imageLink}">
							<button type="submit" class="btn btn-outline-success btn-sm">북마크 추가</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- DB 기반 음식점 목록 -->
	<div th:if="${restaurants != null}">
		<h2 class="mb-3">저장된 음식점</h2>
		<div class="table-responsive">
			<table class="table table-striped table-hover">
				<thead class="table-dark">
				<tr>
					<th>ID</th>
					<th>제목</th>
					<th>카테고리</th>
					<th>주소</th>
					<th>액션</th>
				</tr>
				</thead>
				<tbody>
				<tr th:each="restaurant : ${restaurants.content}">
					<td th:text="${restaurant.id}"></td>
					<td th:text="${restaurant.title}"></td>
					<td th:text="${restaurant.category}"></td>
					<td th:text="${restaurant.address}"></td>
					<td>
						<form th:action="@{/api/restaurants/{id}(id=${restaurant.id})}" method="post" th:method="delete" class="d-inline">
							<button type="submit" class="btn btn-outline-danger btn-sm">삭제</button>
						</form>
					</td>
				</tr>
				</tbody>
			</table>
		</div>

		<!-- 페이징 -->
		<nav th:if="${restaurants.totalPages > 1}" aria-label="Page navigation">
			<ul class="pagination justify-content-center">
				<li class="page-item" th:classappend="${restaurants.first} ? 'disabled'">
					<a class="page-link" th:href="@{/restaurants(page=${restaurants.number - 1}, size=${restaurants.size}, query=${param.query})}">이전</a>
				</li>
				<li class="page-item" th:each="i : ${#numbers.sequence(0, restaurants.totalPages - 1)}" th:classappend="${i == restaurants.number} ? 'active'">
					<a class="page-link" th:href="@{/restaurants(page=${i}, size=${restaurants.size}, query=${param.query})}" th:text="${i + 1}"></a>
				</li>
				<li class="page-item" th:classappend="${restaurants.last} ? 'disabled'">
					<a class="page-link" th:href="@{/restaurants(page=${restaurants.number + 1}, size=${restaurants.size}, query=${param.query})}">다음</a>
				</li>
			</ul>
		</nav>
	</div>
</main>
</html>